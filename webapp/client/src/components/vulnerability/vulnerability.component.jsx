import { Row, Col, Typography, Card, Tag, List, Button, Tooltip, Collapse, Divider } from "antd";
import { LeftOutlined, WarningOutlined, ToolOutlined, CalendarOutlined } from '@ant-design/icons';

const { Title, Text, Paragraph } = Typography;
const { Panel } = Collapse;

// This component shows detailed information about a specific vulnerability (CVE)
const Vulnerability = ({ data, onBack }) => {
    // Data structure:
    // {
    //   cveId: "CVE-2023-12345",
    //   description: "Long description of the vulnerability",
    //   severity: 8.5,
    //   published: "2023-05-12",
    //   modified: "2023-06-15",
    //   attackPatterns: [
    //     { id: "T1190", name: "Exploit Public-Facing Application", description: "...", mitigation: "..."}
    //   ]
    // }

    // Function to determine severity color based on score
    const getSeverityColor = (score) => {
        if (score >= 8) return "#ff968a";
        if (score >= 6) return "#fda703";
        return "green";
    };

    return (
        <>
            <div style={{ paddingLeft: "15%", paddingRight: "15%" }}>
                <Row>
                    <Col xs={24} style={{ padding: "25px" }}>
                        <Tooltip title={`Go back`}>
                            <Button type="link" onClick={onBack} style={{ marginBottom: '20px', fontWeight: "bold" }}>
                                <LeftOutlined /> Go Back
                            </Button>
                        </Tooltip>
                    </Col>
                </Row>

                <Row style={{ backgroundColor: "#595959", paddingTop: "25px", borderRadius: "10px 10px 0 0" }}>
                    <Col xs={24} md={24} style={{ backgroundColor: "#595959" }}>
                        <p style={{ color: "white", marginLeft: "25px" }}>Vulnerability Details</p>
                    </Col>
                </Row>

                <Row style={{ backgroundColor: "#dedede", padding: "25px", borderRadius: "0 0 10px 10px" }}>
                    <Col xs={24} md={24}>
                        <div style={{ display: "flex", alignItems: "center", marginBottom: "20px" }}>
                            <Title level={2} style={{ margin: 0, marginRight: "15px" }}>{data.cveId}</Title>
                            <Tag 
                                color={getSeverityColor(data.severity)} 
                                style={{ fontSize: "16px", padding: "5px 10px" }}
                            >
                                Priority Score: {data.severity}
                            </Tag>
                        </div>

                        <Paragraph style={{ fontSize: "16px", marginBottom: "20px" }}>
                            {data.description}
                        </Paragraph>

                        <Row gutter={[16, 16]}>
                            <Col xs={24} md={12}>
                                <Text type="secondary" style={{ display: "flex", alignItems: "center" }}>
                                    <CalendarOutlined style={{ marginRight: "8px" }} /> Published: {data.published}
                                </Text>
                            </Col>
                            <Col xs={24} md={12}>
                                <Text type="secondary" style={{ display: "flex", alignItems: "center" }}>
                                    <CalendarOutlined style={{ marginRight: "8px" }} /> Last Modified: {data.modified}
                                </Text>
                            </Col>
                        </Row>

                        <Divider />

                        {data.attackPatterns && data.attackPatterns.length > 0 && (
                            <Card 
                                title={<div><WarningOutlined style={{ marginRight: "10px", color: "#ff7875" }} />Attack Patterns & Mitigations</div>}
                                style={{ marginBottom: "20px" }}
                                bordered={false}
                            >
                                {data.attackPatterns.map((pattern, index) => (
                                    <Card 
                                        key={pattern.id}
                                        type="inner" 
                                        title={
                                            <span>
                                                <Tag color="#ff7875">{pattern.id}</Tag> {pattern.name}
                                            </span>
                                        }
                                        style={{ marginBottom: index < data.attackPatterns.length - 1 ? "16px" : 0 }}
                                    >
                                        <Row gutter={[16, 16]}>
                                            <Col xs={24}>
                                                <Title level={5}>Description</Title>
                                                <Paragraph>{pattern.description}</Paragraph>
                                            </Col>
                                            
                                            {pattern.mitigations && Array.isArray(pattern.mitigations) && pattern.mitigations.length > 0 && (
                                                <Col xs={24}>
                                                    <Title level={5}>Mitigations</Title>
                                                    <List
                                                        itemLayout="horizontal"
                                                        dataSource={pattern.mitigations}
                                                        renderItem={(mitigation, index) => (
                                                            <List.Item key={index}>
                                                                <div style={{ display: "flex" }}>
                                                                    <ToolOutlined style={{ color: "#52c41a", marginRight: "10px", marginTop: "4px" }} />
                                                                    <span style={{ fontSize: "16px", lineHeight: "1.5" }}>{mitigation}</span>
                                                                </div>
                                                            </List.Item>
                                                        )}
                                                    />
                                                </Col>
                                            )}
                                        </Row>
                                    </Card>
                                ))}
                            </Card>
                        )}
                    </Col>
                </Row>
            </div>
        </>
    );
};

export default Vulnerability;